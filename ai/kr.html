<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive KR Lab</title>
    <!-- Load Tailwind CSS for professional styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Load Inter font -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* Use a clean, professional font */
        body {
            font-family: 'Inter', sans-serif;
            transition: background-color 0.3s, color 0.3s;
        }
        
        /* Light mode styling */
        body.light-mode {
            background: linear-gradient(135deg, #f1f5f9 0%, #e2e8f0 100%);
            color: #0f172a;
        }
        
        /* Dark mode styling */
        body.dark-mode {
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            color: #f1f5f9;
        }
        
        /* Styling for the main scenario "app" window */
        #scenario-container {
            transition: all 0.3s ease-in-out;
        }
        
        body.light-mode #scenario-container {
            background-color: #ffffff;
            color: #0f172a;
        }
        
        body.dark-mode #scenario-container {
            background-color: #1e293b;
            color: #f1f5f9;
        }
        
        /* Styling for the action buttons */
        .action-button {
            width: 100%;
            text-align: left;
            padding: 1rem;
            border-radius: 0.5rem;
            transition: all 0.15s;
        }
        
        body.light-mode .action-button {
            border: 1px solid #cbd5e1;
            background-color: #ffffff;
            color: #0f172a;
        }
        
        body.light-mode .action-button:hover {
            background-color: #f8fafc;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }
        
        body.dark-mode .action-button {
            border: 1px solid #334155;
            background-color: #334155;
            color: #f1f5f9;
        }
        
        body.dark-mode .action-button:hover {
            background-color: #475569;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.3);
        }
        
        .action-button:focus {
            outline: none;
            ring: 2px;
            ring-color: #3b82f6;
        }
        
        .action-button strong {
            display: block;
            font-size: 1.125rem;
            font-weight: 600;
        }
        
        body.light-mode .action-button strong {
            color: #1d4ed8;
        }
        
        body.dark-mode .action-button strong {
            color: #60a5fa;
        }
        
        .action-button span {
            font-size: 0.875rem;
        }
        
        body.light-mode .action-button span {
            color: #475569;
        }
        
        body.dark-mode .action-button span {
            color: #cbd5e1;
        }

        /* Checkbox styling */
        .form-checkbox {
            @apply w-5 h-5 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500 dark:focus:ring-blue-600 dark:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-gray-600;
        }
        .form-label {
            @apply ml-2 text-sm font-medium text-gray-900 dark:text-gray-300;
        }
        
        /* Modal styling */
        body.light-mode #modal-panel {
            background-color: #ffffff;
            color: #0f172a;
        }
        
        body.dark-mode #modal-panel {
            background-color: #1e293b;
            color: #f1f5f9;
        }
        
        body.light-mode #modal-title {
            color: #1d4ed8;
        }
        
        body.dark-mode #modal-title {
            color: #60a5fa;
        }
        
        body.light-mode #modal-body {
            color: #334155;
        }
        
        body.dark-mode #modal-body {
            color: #e2e8f0;
        }
        
        body.light-mode .font-mono {
            background-color: #f1f5f9;
            color: #0f172a;
        }
        
        body.dark-mode .font-mono {
            background-color: #334155;
            color: #e2e8f0;
        }
        
        /* Button styling */
        body.light-mode button {
            color: inherit;
        }
        
        body.dark-mode button {
            color: inherit;
        }
        
        /* Input styling */
        body.light-mode input[type="text"] {
            background-color: #f8fafc;
            border-color: #cbd5e1;
            color: #0f172a;
        }
        
        body.dark-mode input[type="text"] {
            background-color: #334155;
            border-color: #475569;
            color: #f1f5f9;
        }
        body.light-mode input.readonly-input {
            background-color: #f1f5f9;
        }
        body.dark-mode input.readonly-input {
            background-color: #334155;
        }

        
        /* Course registration box styling */
        body.light-mode .bg-blue-50 {
            background-color: #eff6ff !important;
            border-color: #bfdbfe !important;
        }
        
        body.dark-mode .bg-blue-50 {
            background-color: #1e3a5f !important;
            border-color: #1e40af !important;
        }
        
        body.light-mode .text-blue-800,
        body.light-mode .text-blue-700 {
            color: #1e40af !important;
        }
        
        body.dark-mode .text-blue-800,
        body.dark-mode .text-blue-700 {
            color: #93c5fd !important;
        }

        /* Recommendation box styling */
        body.light-mode .rec-box {
            border-color: #facc15 !important;
            background-color: #fefce8 !important;
        }
        body.light-mode .rec-box:hover {
            background-color: #fef9c3 !important;
        }
        body.light-mode .rec-box strong {
            color: #a16207 !important;
        }
        body.light-mode .rec-box span {
            color: #ca8a04 !important;
        }

        body.dark-mode .rec-box {
            border-color: #ca8a04 !important;
            background-color: #2a2108 !important;
        }
        body.dark-mode .rec-box:hover {
            background-color: #3b300c !important;
        }
        body.dark-mode .rec-box strong {
            color: #fde047 !important;
        }
        body.dark-mode .rec-box span {
            color: #eab308 !important;
        }

        
        /* Header container */
        .header-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
            gap: 1rem;
        }
        
        .header-title {
            font-size: 1.875rem;
            font-weight: 700;
            margin: 0;
        }
        
        body.light-mode .header-title {
            color: #0f172a;
        }
        
        body.dark-mode .header-title {
            color: #f1f5f9;
        }
        
        .button-group {
            display: flex;
            gap: 0.5rem;
            align-items: center;
        }
        
        .mode-toggle,
        .back-btn {
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            font-weight: 600;
            transition: all 0.2s;
            border: none;
            cursor: pointer;
        }

        /* Hide back button initially */
        .back-btn {
            display: none;
        }
        
        body.light-mode .mode-toggle {
            background-color: #3b82f6;
            color: #ffffff;
        }
        
        body.light-mode .mode-toggle:hover {
            background-color: #2563eb;
        }
        
        body.dark-mode .mode-toggle {
            background-color: #1e40af;
            color: #ffffff;
        }
        
        body.dark-mode .mode-toggle:hover {
            background-color: #1e3a8a;
        }
        
        body.light-mode .back-btn {
            background-color: #64748b;
            color: #ffffff;
        }
        
        body.light-mode .back-btn:hover {
            background-color: #475569;
        }
        
        body.dark-mode .back-btn {
            background-color: #475569;
            color: #ffffff;
        }
        
        body.dark-mode .back-btn:hover {
            background-color: #334155;
        }

        /* Main action button */
        /* .primary-button {
             @apply w-full bg-blue-600 text-white font-medium py-3 px-6 rounded-lg shadow-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-colors duration-200;
        } */
        
        /* Responsive adjustments */
        @media (max-width: 768px) {
            .header-container {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .button-group {
                width: 100%;
                justify-content: flex-end;
            }
        }
    </style>
</head>
<body class="dark-mode flex items-center justify-center min-h-screen p-4 md:p-8">

    <!-- Main Scenario "App" Window -->
    <main id="scenario-container" class="w-full max-w-2xl mx-auto p-6 md:p-10 rounded-lg shadow-2xl">
        <div class="header-container">
            <h1 id="header-title" class="header-title">KR Lab</h1>
            <div class="button-group">
                <button id="back-btn" class="back-btn" title="Go back" onclick="history.back()">
                    ‚Üê Back
                </button>
                <button id="mode-toggle" class="mode-toggle" title="Toggle theme">
                    ‚òÄÔ∏è
                </button>
            </div>
        </div>
        <div id="content-area">
            <!-- Content will be injected here by JavaScript -->
        </div>
    </main>

    <!-- Modal for Explanations (Initially Hidden) -->
    <div id="modal-backdrop" class="fixed inset-0 bg-black/60 flex items-center justify-center p-4 transition-opacity duration-300 opacity-0 pointer-events-none hidden z-50">
        <div id="modal-panel" class="p-6 md:p-8 rounded-lg shadow-xl max-w-lg w-full transform scale-95 transition-all duration-300">
            <div class="flex justify-between items-center pb-3 mb-4" style="border-bottom: 1px solid #475569;">
                <h2 id="modal-title" class="text-xl font-bold"></h2>
                <button id="modal-close-x" class="hover:opacity-70 text-3xl leading-none" style="color: #94a3b8;">&times;</button>
            </div>
            <div id="modal-body" class="text-base space-y-4">
                <!-- Modal content injected here -->
            </div>
            <button id="modal-close" class="mt-6 w-full bg-blue-600 text-white font-medium py-2 px-6 rounded-lg shadow-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-colors duration-200">
                Continue
            </button>
        </div>
    </div>

    <script>
        // --- DOM Elements ---
        const contentArea = document.getElementById('content-area');
        const modalBackdrop = document.getElementById('modal-backdrop');
        const modalPanel = document.getElementById('modal-panel');
        const modalTitle = document.getElementById('modal-title');
        const modalBody = document.getElementById('modal-body');
        const modalClose = document.getElementById('modal-close');
        const modalCloseX = document.getElementById('modal-close-x');
        const themeToggle = document.getElementById('mode-toggle');
        const body = document.body;
        const headerTitle = document.getElementById('header-title');
        const backBtn = document.getElementById('back-btn');

        // --- Global State ---
        let student = {}; // This will hold the *active* student object
        let currentScreen = ''; // To manage back button state

        // --- Simulated Course Data ---
        const courses = {
            "CSC 405": { title: "Artificial Intelligence", prereq: "CSC 301" },
            "CSC 407": { title: "Compiler Construction", prereq: "CSC 303" }
        };

        // --- Theme Toggle Logic ---
        function setTheme(theme) {
            body.className = theme + '-mode flex items-center justify-center min-h-screen p-4 md:p-8';
            themeToggle.textContent = (theme === 'dark') ? '‚òÄÔ∏è' : 'üåô';
            localStorage.setItem('theme', theme);
        }
        themeToggle.addEventListener('click', () => {
            const newTheme = body.classList.contains('dark-mode') ? 'light' : 'dark';
            setTheme(newTheme);
        });
        // Initial theme setup
        setTheme(localStorage.getItem('theme') || 'dark');


        // --- Modal Functions ---
        function showModal(title, bodyHTML) {
            modalTitle.textContent = title;
            modalBody.innerHTML = bodyHTML;
            modalBackdrop.classList.remove('hidden');
            setTimeout(() => {
                modalBackdrop.classList.remove('opacity-0', 'pointer-events-none');
                modalPanel.classList.remove('scale-95');
            }, 10);
        }

        function closeModal() {
            modalBackdrop.classList.add('opacity-0', 'pointer-events-none');
            modalPanel.classList.add('scale-95');
            setTimeout(() => {
                modalBackdrop.classList.add('hidden');
            }, 300);
        }

        // --- Event Listeners for Modal ---
        modalClose.addEventListener('click', closeModal);
        modalCloseX.addEventListener('click', closeModal);
        modalBackdrop.addEventListener('click', (e) => {
            if (e.target === modalBackdrop) {
                closeModal();
            }
        });

        // --- Back Button Logic ---
        /* REMOVED: State-based back button listener
        backBtn.addEventListener('click', () => {
            if (currentScreen === 'login') {
                renderPersonaCreator();
            } else if (currentScreen === 'dashboard') {
                renderLogin();
            } else if (currentScreen === 'courses') {
                renderDashboard();
            }
        });
        */

        function setScreen(screenName) {
            currentScreen = screenName;
            backBtn.style.display = 'inline-block'; // ALWAYS show the back button
            if (screenName === 'creator') {
                headerTitle.textContent = "KR Lab: Create Persona";
                // backBtn.style.display = 'none'; // REMOVED
            } else if (screenName === 'login') {
                headerTitle.textContent = "University Portal";
                // backBtn.style.display = 'inline-block'; // REMOVED (now handled above)
            } else if (screenName === 'dashboard') {
                headerTitle.textContent = "Student Dashboard";
                // backBtn.style.display = 'inline-block'; // REMOVED (now handled above)
            } else if (screenName === 'courses') {
                headerTitle.textContent = "Course Registration";
                // backBtn.style.display = 'inline-block'; // REMOVED (now handled above)
            }
        }


        // --- Scenario Rendering Functions ---

        /**
         * NEW: Renders the initial Persona Creator Screen
         */
        function renderPersonaCreator() {
            setScreen('creator');
            contentArea.innerHTML = `
                <header class="mb-6">
                    <h1 class="text-2xl font-semibold">Create Your Student Persona</h1>
                    <p class="text-base" style="opacity: 0.8;">Fill out the <strong>Frame</strong> (template) to create a student. The system's <strong>Rules</strong> will react to the data you provide.</p>
                </header>
                <div class="space-y-4">
                    <!-- Field for Name -->
                    <div>
                        <label for="student-name" class="block text-sm font-medium" style="opacity: 0.9;">Student Name</label>
                        <input type="text" id="student-name" class="mt-1 block w-full px-3 py-2 border rounded-md shadow-sm" placeholder="e.g., 'Bisi Adewale'">
                    </div>
                    
                    <!-- Checkboxes for Passed Courses -->
                    <div class="pt-2">
                        <label class="block text-sm font-medium" style="opacity: 0.9;">Passed Courses (Transcript)</label>
                        <div class="mt-2 space-y-2">
                            <div class="flex items-center">
                                <input id="prereq-csc301" type="checkbox" value="CSC 301" class="form-checkbox">
                                <label for="prereq-csc301" class="form-label">CSC 301 (AI Prerequisite)</label>
                            </div>
                            <div class="flex items-center">
                                <input id="prereq-csc303" type="checkbox" value="CSC 303" class="form-checkbox">
                                <label for="prereq-csc303" class="form-label">CSC 303 (Compiler Prerequisite)</label>
                            </div>
                            <div class="flex items-center">
                                <input id="prereq-gns101" type="checkbox" value="GNS 101" class="form-checkbox">
                                <label for="prereq-gns101" class="form-label">GNS 101 (Use of English)</label>
                            </div>
                        </div>
                    </div>
                    
                    <div class="pt-4 flex justify-center">
                        <button id="start-simulation-btn" class="bg-blue-600 text-white font-medium py-3 px-6 rounded-lg shadow-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-colors duration-200">
                            Start Simulation
                        </button>
                    </div>
                </div>
            `;
            
            document.getElementById('start-simulation-btn').addEventListener('click', handleCreatePersona);
        }

        /**
         * NEW: Handles creating the student and moving to login
         */
        function handleCreatePersona() {
            const studentName = document.getElementById('student-name').value || "Default Student";
            const passedCourses = [];
            
            if (document.getElementById('prereq-csc301').checked) {
                passedCourses.push("CSC 301");
            }
            if (document.getElementById('prereq-csc303').checked) {
                passedCourses.push("CSC 303");
            }
            if (document.getElementById('prereq-gns101').checked) {
                passedCourses.push("GNS 101");
            }

            // Create the student object (the Frame Instance)
            student = {
                name: studentName,
                matric: "CSC/2024/001", // A dynamic one
                cgpa: 3.5 + (Math.random() * 1.5).toFixed(2), // Random CGPA
                status: "Active",
                passedCourses: passedCourses,
                registeredCourses: []
            };
            
            // Show a modal explaining what just happened (Frame creation)
            showModal(
                "KNOWLEDGE IN ACTION: 3. Frames",
                `
                <p>You just created an <strong>instance</strong> of a <strong>Frame</strong>.</p>
                <p>The "Student" template (the Frame) was filled with your custom data. The system will now use this specific "instance" for the simulation.</p>
                <div class="font-mono text-sm bg-slate-100 p-3 rounded-md">
                    <strong>Frame Instance:</strong>
                    <br>
                    - Name: "${student.name}"
                    <br>
                    - Passed: [${student.passedCourses.join(', ')}]
                </div>
                <p>Click "Continue" to log in as this new student.</p>
                `
            );
            
            // Go to login screen after modal is closed
            const onModalClose = () => {
                renderLogin();
                modalClose.removeEventListener('click', onModalClose);
                modalCloseX.removeEventListener('click', onModalClose);
            };
            modalClose.addEventListener('click', onModalClose);
            modalCloseX.addEventListener('click', onModalClose);
        }


        /**
         * Renders the welcome/login screen
         */
        function renderLogin() {
            setScreen('login');
            contentArea.innerHTML = `
                <header class="mb-6 text-center">
                    <p class="text-lg mt-2" style="opacity: 0.8;">Knowledge Representation Lab</p>
                </header>
                <div class="space-y-4 max-w-md mx-auto">
                    <p class="text-center" style="opacity: 0.9;">You are logging in as <strong>${student.name}</strong>.</p>
                    <div>
                        <label for="matric" class="block text-sm font-medium" style="opacity: 0.9;">Matriculation Number</label>
                        <input type="text" id="matric" value="${student.matric}" readonly class="mt-1 block w-full px-3 py-2 border rounded-md shadow-sm cursor-not-allowed readonly-input">
                    </div>
                    <div>
                        <label for="password" class="block text-sm font-medium" style="opacity: 0.9;">Password</label>
                        <input type="password" id="password" value="************" readonly class="mt-1 block w-full px-3 py-2 border rounded-md shadow-sm cursor-not-allowed readonly-input">
                    </div>
                    <div class="flex justify-center">
                        <button id="login-button" class="bg-blue-600 text-white font-medium py-3 px-6 rounded-lg shadow-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-colors duration-200">
                            Login
                        </button>
                    </div>
                </div>
            `;
            
            document.getElementById('login-button').addEventListener('click', handleLogin);
        }

        /**
         * Renders the student dashboard with choices
         */
        function renderDashboard() {
            setScreen('dashboard');
            contentArea.innerHTML = `
                <header class="mb-6">
                    <h1 class="text-2xl font-semibold">Welcome, ${student.name}</h1>
                    <p class="text-base" style="opacity: 0.8;">What would you like to do?</p>
                </header>
                <div class="space-y-4">
                    <button id="profile-button" class="action-button">
                        <strong>View My Profile Details</strong>
                        <span>Check your CGPA, Status, and other static data.</span>
                    </button>
                    <button id="register-button" class="action-button">
                        <strong>Register for Courses</strong>
                        <span>Add or drop courses for the semester.</span>
                    </button>
                    <button id="graduate-button" class="action-button">
                        <strong>Check Graduation Status</strong>
                        <span>Verify clearance and Senate approval.</span>
                    </button>
                </div>
                <button id="logout-button" class="mt-8 text-sm" style="opacity: 0.7;">&larr; Change Student (Log Out)</button>
            `;

            // Attach new event listeners
            document.getElementById('profile-button').addEventListener('click', handleViewProfile);
            document.getElementById('register-button').addEventListener('click', renderCourseList);
            document.getElementById('graduate-button').addEventListener('click', handleGraduationCheck);
            document.getElementById('logout-button').addEventListener('click', renderPersonaCreator);
        }

        /**
         * Renders the course registration page
         */
        function renderCourseList() {
            setScreen('courses');
            contentArea.innerHTML = `
                <header class="mb-6">
                    <h1 class="text-2xl font-semibold">Course Registration</h1>
                    <p class="text-base" style="opacity: 0.8;">Attempt to add a 400-Level elective.</p>
                </header>
                <div class="bg-blue-50 border border-blue-200 p-4 rounded-lg mb-6">
                    <h4 class="font-semibold text-blue-800">Your Custom Transcript:</h4>
                    <p class="text-sm text-blue-700">You have passed: ${student.passedCourses.length > 0 ? student.passedCourses.join(', ') : 'None'}</p>
                </div>
                
                <div class="space-y-4">
                    <!-- Course 1 -->
                    <div class="flex justify-between items-center p-4 border rounded-lg">
                        <div>
                            <strong class="block text-lg font-semibold">CSC 405: Artificial Intelligence</strong>
                            <span class="text-sm" style="opacity: 0.7;">Prerequisite: CSC 301</span>
                        </div>
                        <button id="btn-csc405" data-course="CSC 405" class="add-course-btn bg-green-600 text-white font-medium py-2 px-4 rounded-lg hover:bg-green-700 transition-colors">
                            Add
                        </button>
                    </div>
                    
                    <!-- Course 2 -->
                    <div class="flex justify-between items-center p-4 border rounded-lg">
                        <div>
                            <strong class="block text-lg font-semibold">CSC 407: Compiler Construction</strong>
                            <span class="text-sm" style="opacity: 0.7;">Prerequisite: CSC 303</span>
                        </div>
                        <button id="btn-csc407" data-course="CSC 407" class="add-course-btn bg-green-600 text-white font-medium py-2 px-4 rounded-lg hover:bg-green-700 transition-colors">
                            Add
                        </button>
                    </div>

                    <!-- Course 3 -->
                    <div class="flex justify-between items-center p-4 border rounded-lg">
                        <div>
                            <strong class="block text-lg font-semibold">GNS 101: Use of English</strong>
                            <span class="text-sm" style="opacity: 0.7;">Prerequisite: None</span>
                        </div>
                        <button id="btn-gns101" data-course="GNS 101" class="add-course-btn bg-green-600 text-white font-medium py-2 px-4 rounded-lg hover:bg-green-700 transition-colors">
                            Add
                        </button>
                    </div>
                </div>

                <!-- NEW: Placeholder for Semantic Net recommendations -->
                <div id="recommendation-box" class="mt-6"></div>

                <button id="back-to-dash-button" class="mt-8 text-sm" style="opacity: 0.7;">&larr; Back to Dashboard</button>
            `;

            // --- NEW: Logic to update button states and show recommendations ---
            
            // Update button states based on what's already registered or passed
            updateButtonStates();

            // If AI was added, show the recommendation box
            if (student.registeredCourses.includes("CSC 405")) {
                const recBox = document.getElementById('recommendation-box');
                recBox.innerHTML = `
                    <button id="show-semantic-modal" class="action-button rec-box">
                        <strong>Recommendations</strong>
                        <span>Because you added AI, you might like Machine Learning or Data Mining. <strong>Click to see why.</strong></span>
                    </button>
                `;
                document.getElementById('show-semantic-modal').addEventListener('click', handleShowSemanticModal);
            }
            // --- END NEW LOGIC ---


            // Attach listeners for all "Add" buttons
            document.querySelectorAll('.add-course-btn').forEach(button => {
                button.addEventListener('click', (e) => handleAddCourse(e.target.dataset.course, e.target));
            });
            document.getElementById('back-to-dash-button').addEventListener('click', renderDashboard);
        }
        
        /**
         * NEW: Updates button states on the course list page
         */
        function updateButtonStates() {
            const btn405 = document.getElementById('btn-csc405');
            const btn407 = document.getElementById('btn-csc407');
            const btn101 = document.getElementById('btn-gns101');

            if (!btn405) return; // In case we're on another screen

            // Check CSC 405
            if (student.registeredCourses.includes("CSC 405")) {
                styleButton(btn405, "Added", "disabled");
            }

            // Check CSC 407
            if (student.registeredCourses.includes("CSC 407")) {
                styleButton(btn407, "Added", "disabled");
            } 

            // Check GNS 101
            if (student.passedCourses.includes("GNS 101")) {
                // You can't *add* it, but we'll let the click handler explain why
                styleButton(btn101, "Passed", "disabled");
            } else if (student.registeredCourses.includes("GNS 101")) {
                styleButton(btn101, "Added", "disabled");
            }
        }

        /**
         * NEW: Helper function to style buttons
         */
        function styleButton(button, text, state) {
            if (!button) return;
            button.textContent = text;
            button.disabled = true;
            button.classList.remove('bg-green-600', 'hover:bg-green-700', 'bg-red-500');
            
            if (state === "disabled") {
                button.classList.add('bg-slate-400', 'cursor-not-allowed');
                if (body.classList.contains('dark-mode')) {
                    button.classList.add('dark:bg-slate-600');
                }
            } else if (state === "failed") {
                button.classList.add('bg-red-500', 'cursor-not-allowed');
                if (body.classList.contains('dark-mode')) {
                    button.classList.add('dark:bg-red-700');
                }
            }
        }
        
        /**
         * Renders the related courses (Semantic Net) step
         */
         function handleShowSemanticModal() {
            // Show the modal explaining this
            showModal(
                "KNOWLEDGE IN ACTION: 4. Semantic Networks",
                `
                <p><strong>How did the system know these courses were related?</strong></p>
                <p>This recommendation is <strong>not</strong> based on your custom profile. It's a "mind map" (a Semantic Network) that defines relationships between *concepts*.</p>
                <div class="font-mono text-sm bg-slate-100 p-3 rounded-md">
                    (AI) ---[has-subfield]---> (Machine Learning)
                    <br>
                    (AI) ---[uses-technique]---> (Data Mining)
                </div>
                <p>By traversing this graph, the system can make intelligent recommendations, regardless of who the student is.</p>
                `
            );
         }


        // --- Event Handler Functions ---

        function handleLogin() {
            // Show the modal first
            showModal(
                "KNOWLEDGE IN ACTION: 1. Logic",
                `
                <p>The system just used <strong>Propositional Logic</strong> to authenticate you.</p>
                <p>It evaluated a formal, true/false statement:</p>
                <div class="font-mono text-sm bg-slate-100 p-3 rounded-md">
                    IF IsValid(User) AND CorrectPassword(User)
                    <br>
                    THEN GrantAccess = <strong>TRUE</strong>
                </div>
                <p>Like a "Legal Contract," this rule is rigid and unambiguous. It doesn't care *who* you are, only that the credentials are valid.</p>
                `
            );
            // Render the next screen (dashboard) after modal is closed
            const onModalClose = () => {
                renderDashboard();
                modalClose.removeEventListener('click', onModalClose);
                modalCloseX.removeEventListener('click', onModalClose);
            };
            modalClose.addEventListener('click', onModalClose);
            modalCloseX.addEventListener('click', onModalClose);
        }

        function handleViewProfile() {
            // Show modal explaining the action
            showModal(
                "KNOWLEDGE IN ACTION: 3. Frames",
                `
                <p>This is the <strong>Frame Instance</strong> you just created.</p>
                <p>The system is simply displaying the data you provided, perfectly organized into the "Student" template (the Frame).</p>
                <div class="font-mono text-sm bg-slate-100 p-3 rounded-md">
                    <strong>Frame:</strong> Student_Profile
                    <br>
                    <strong>Slots:</strong>
                    <br>
                    - Name: "${student.name}"
                    <br>
                    - CGPA: ${student.cgpa}
                    <br>
                    - Passed: [${student.passedCourses.join(', ')}]
                </div>
                <p>This is the data the system will use to make decisions.</p>
                `
            );
            // This action doesn't change the screen, just shows info.
        }

        function handleAddCourse(courseId, button) {
            const course = courses[courseId];
            
            // Check for prerequisite (the "Rule")
            if (course && student.passedCourses.includes(course.prereq)) {
                // SUCCESS
                student.registeredCourses.push(courseId); // Add to our list
                showModal(
                    "KNOWLEDGE IN ACTION: 2. Rules (IF-THEN)",
                    `
                    <p><strong class="text-green-600">SUCCESS:</strong> Course added.</p>
                    <p>The system's "Inference Engine" checked its <strong>Rules</strong> against your custom <strong>Frame</strong>.</p>
                    <div class="font-mono text-sm bg-slate-100 p-3 rounded-md">
                        <strong>Rule:</strong> IF Prerequisite_Passed("${course.prereq}") THEN Allow_Registration.
                        <br>
                        <strong>Fact:</strong> Your frame's "passedCourses" slot <strong>contains</strong> "${course.prereq}".
                        <br>
                        <strong>Result:</strong> TRUE.
                    </div>
                    `
                );
                
                // NEW: Re-render the course list when modal closes
                const onModalClose = () => {
                    renderCourseList();
                    modalClose.removeEventListener('click', onModalClose);
                    modalCloseX.removeEventListener('click', onModalClose);
                };
                modalClose.addEventListener('click', onModalClose);
                modalCloseX.addEventListener('click', onModalClose);


            } else if (courseId === "GNS 101") {
                // Check if already passed
                if (student.passedCourses.includes("GNS 101")) {
                     showModal(
                        "KNOWLEDGE IN ACTION: 2. Rules (IF-THEN)",
                        `
                        <p><strong class="text-red-600">FAILED:</strong> Course already passed.</p>
                        <p>The system's "Inference Engine" checked another rule against your <strong>Frame</strong>.</p>
                        <div class="font-mono text-sm bg-slate-100 p-3 rounded-md">
                            <strong>Rule:</strong> IF Course_ID is in "passedCourses" THEN Block_Registration.
                            <br>
                            <strong>Fact:</strong> Your frame <strong>contains</strong> "GNS 101".
                            <br>
                            <strong>Result:</strong> TRUE. (Registration Blocked)
                        </div>
                        `
                    );
                    styleButton(button, "Passed", "disabled");
                } else {
                    // SUCCESS (No prereq)
                    student.registeredCourses.push(courseId); // Add to our list
                    showModal(
                        "KNOWLEDGE IN ACTION: 2. Rules (IF-THEN)",
                        `
                        <p><strong class="text-green-600">SUCCESS:</strong> Course added.</p>
                        <p>The system's "Inference Engine" checked its rules.</p>
                        <div class="font-mono text-sm bg-slate-100 p-3 rounded-md">
                            <strong>Rule:</strong> IF Prerequisite_Passed(None) THEN Allow_Registration.
                            <br>
                            <strong>Fact:</strong> The course has no prerequisite.
                            <br>
                            <strong>Result:</strong> TRUE.
                        </div>
                        `
                    );
                    // NEW: Re-render the course list when modal closes
                    const onModalClose = () => {
                        renderCourseList();
                        modalClose.removeEventListener('click', onModalClose);
                        modalCloseX.removeEventListener('click', onModalClose);
                    };
                    modalClose.addEventListener('click', onModalClose);
                    modalCloseX.addEventListener('click', onModalClose);
                }
                
            } else {
                // FAILURE
                showModal(
                    "KNOWLEDGE IN ACTION: 2. Rules (IF-THEN)",
                    `
                    <p><strong class="text-red-600">FAILED:</strong> Prerequisite not met.</p>
                    <p>The system's "Inference Engine" checked its <strong>Rules</strong> against your custom <strong>Frame</strong>.</p>
                    <div class="font-mono text-sm bg-slate-100 p-3 rounded-md">
                        <strong>Rule:</strong> IF Prerequisite_Passed("${(course && course.prereq) ? course.prereq : 'CSC 303'}") THEN Allow_Registration.
                        <br>
                        <strong>Fact:</strong> Your frame's "passedCourses" slot <strong>does not contain</strong> "${(course && course.prereq) ? course.prereq : 'CSC 303'}".
                        <br>
                        <strong>Result:</strong> FALSE.
                    </div>
                    `
                );
                styleButton(button, "Failed", "failed");
            }
        }

        function handleGraduationCheck() {
            showModal(
                "KNOWLEDGE IN ACTION: 5. Ontologies",
                `
                <p><strong class="text-red-600">STATUS:</strong> Pending Senate Approval.</p>
                <p>This check uses an <strong>Ontology</strong>. Notice this result is the <strong>same for all students</strong>, no matter what data you entered in your <strong>Frame</strong>.</p>
                <p>An Ontology defines the fundamental, unchangeable "constitution" of the system.</p>
                <div class="font-mono text-sm bg-slate-100 p-3 rounded-md">
                    <strong>Strict Rule:</strong> (Approve_Graduation(Lecturer)) is <strong>NOT_ALLOWED</strong>.
                    <br>
                    <strong>Strict Rule:</strong> (Approve_Graduation(Senate)) is <strong>ALLOWED</strong>.
                </div>
                <p>This contrasts with IF-THEN rules, which change based on your data. Ontological rules do not.</p>
                `
            );
        }

        // --- Initial Render ---
        renderPersonaCreator(); // Start at the new creator screen
        
    </script>
</body>
</html>
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive KR Lab</title>
    <!-- Load Tailwind CSS for professional styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Use a clean, professional font */
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Styling for the main scenario "app" window */
        #scenario-container {
            transition: all 0.3s ease-in-out;
        }
        /* Styling for the action buttons */
        .action-button {
            @apply w-full text-left p-4 rounded-lg border border-slate-300 bg-white hover:bg-slate-50 hover:shadow-md focus:outline-none focus:ring-2 focus:ring-blue-500 transition-all duration-150;
        }
        .action-button strong {
            @apply block text-lg font-semibold text-blue-700;
        }
        .action-button span {
            @apply text-sm text-slate-600;
        }
    </style>
</head>
<body class="bg-slate-200 text-slate-800 flex items-center justify-center min-h-screen p-4 md:p-8">

    <!-- Main Scenario "App" Window -->
    <main id="scenario-container" class="w-full max-w-2xl mx-auto bg-white p-6 md:p-10 rounded-lg shadow-2xl">
        <!-- Content will be injected here by JavaScript -->
    </main>

    <!-- Modal for Explanations (Initially Hidden) -->
    <div id="modal-backdrop" class="fixed inset-0 bg-black/60 flex items-center justify-center p-4 transition-opacity duration-300 opacity-0 pointer-events-none hidden">
        <div id="modal-panel" class="bg-white p-6 md:p-8 rounded-lg shadow-xl max-w-lg w-full transform scale-95 transition-all duration-300">
            <div class="flex justify-between items-center border-b border-slate-200 pb-3 mb-4">
                <h2 id="modal-title" class="text-xl font-bold text-blue-700"></h2>
                <button id="modal-close-x" class="text-slate-400 hover:text-slate-700 text-3xl leading-none">&times;</button>
            </div>
            <div id="modal-body" class="text-base text-slate-700 space-y-4">
                <!-- Modal content injected here -->
            </div>
            <button id="modal-close" class="mt-6 w-full bg-blue-600 text-white font-medium py-2 px-6 rounded-lg shadow-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-colors duration-200">
                Continue
            </button>
        </div>
    </div>

    <script>
        // --- DOM Elements ---
        const scenarioContainer = document.getElementById('scenario-container');
        const modalBackdrop = document.getElementById('modal-backdrop');
        const modalPanel = document.getElementById('modal-panel');
        const modalTitle = document.getElementById('modal-title');
        const modalBody = document.getElementById('modal-body');
        const modalClose = document.getElementById('modal-close');
        const modalCloseX = document.getElementById('modal-close-x');

        // --- Simulated Student Data ---
        const student = {
            name: "John Doe",
            matric: "CSC/2021/042",
            cgpa: 4.35,
            status: "Active",
            passedCourses: ["CSC 301", "MTH 301", "GNS 101"],
            registeredCourses: [] // Track added courses
        };

        // --- Simulated Course Data ---
        const courses = {
            "CSC 405": { title: "Artificial Intelligence", prereq: "CSC 301" },
            "CSC 407": { title: "Compiler Construction", prereq: "CSC 303" }
        };

        // --- Modal Functions ---
        function showModal(title, bodyHTML) {
            modalTitle.textContent = title;
            modalBody.innerHTML = bodyHTML;
            modalBackdrop.classList.remove('hidden');
            setTimeout(() => {
                modalBackdrop.classList.remove('opacity-0', 'pointer-events-none');
                modalPanel.classList.remove('scale-95');
            }, 10);
        }

        function closeModal() {
            modalBackdrop.classList.add('opacity-0', 'pointer-events-none');
            modalPanel.classList.add('scale-95');
            setTimeout(() => {
                modalBackdrop.classList.add('hidden');
            }, 300);
        }

        // --- Event Listeners for Modal ---
        modalClose.addEventListener('click', closeModal);
        modalCloseX.addEventListener('click', closeModal);
        modalBackdrop.addEventListener('click', (e) => {
            if (e.target === modalBackdrop) {
                closeModal();
            }
        });

        // --- Scenario Rendering Functions ---

        /**
         * Renders the initial welcome/login screen
         */
        function renderLogin() {
            scenarioContainer.innerHTML = `
                <header class="mb-6 text-center">
                    <h1 class="text-3xl font-bold text-blue-700">University Portal</h1>
                    <p class="text-lg text-slate-600 mt-2">Knowledge Representation Lab</p>
                </header>
                <div class="space-y-4 max-w-md mx-auto">
                    <p class="text-center text-slate-700">Let's begin the course registration simulation.</p>
                    <div>
                        <label for="matric" class="block text-sm font-medium text-slate-700">Matriculation Number</label>
                        <input type="text" id="matric" value="${student.matric}" readonly class="mt-1 block w-full px-3 py-2 bg-slate-100 border border-slate-300 rounded-md shadow-sm cursor-not-allowed">
                    </div>
                    <div>
                        <label for="password" class="block text-sm font-medium text-slate-700">Password</label>
                        <input type="password" id="password" value="************" readonly class="mt-1 block w-full px-3 py-2 bg-slate-100 border border-slate-300 rounded-md shadow-sm cursor-not-allowed">
                    </div>
                    <button id="login-button" class="w-full bg-blue-600 text-white font-medium py-3 px-6 rounded-lg shadow-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-colors duration-200">
                        Login
                    </button>
                </div>
            `;
            
            document.getElementById('login-button').addEventListener('click', handleLogin);
        }

        /**
         * Renders the student dashboard with choices
         */
        function renderDashboard() {
            scenarioContainer.innerHTML = `
                <header class="mb-6">
                    <h1 class="text-2xl font-semibold text-slate-900">Welcome, ${student.name}</h1>
                    <p class="text-base text-slate-600">What would you like to do?</p>
                </header>
                <div class="space-y-4">
                    <button id="profile-button" class="action-button">
                        <strong>View My Profile Details</strong>
                        <span>Check your CGPA, Status, and other static data.</span>
                    </button>
                    <button id="register-button" class="action-button">
                        <strong>Register for Courses</strong>
                        <span>Add or drop courses for the semester.</span>
                    </button>
                    <button id="graduate-button" class="action-button">
                        <strong>Check Graduation Status</strong>
                        <span>Verify clearance and Senate approval.</span>
                    </button>
                </div>
                <button id="logout-button" class="mt-8 text-sm text-slate-500 hover:text-blue-600">Log Out</button>
            `;

            // Attach new event listeners
            document.getElementById('profile-button').addEventListener('click', handleViewProfile);
            document.getElementById('register-button').addEventListener('click', renderCourseList);
            document.getElementById('graduate-button').addEventListener('click', handleGraduationCheck);
            document.getElementById('logout-button').addEventListener('click', renderLogin);
        }

        /**
         * Renders the course registration page
         */
        function renderCourseList() {
            scenarioContainer.innerHTML = `
                <header class="mb-6">
                    <h1 class="text-2xl font-semibold text-slate-900">Course Registration</h1>
                    <p class="text-base text-slate-600">Attempt to add a 400-Level elective.</p>
                </header>
                <div class="bg-blue-50 border border-blue-200 p-4 rounded-lg mb-6">
                    <h4 class="font-semibold text-blue-800">Your (Simulated) Transcript:</h4>
                    <p class="text-sm text-blue-700">You have passed: ${student.passedCourses.join(', ')}</p>
                </div>
                
                <div class="space-y-4">
                    <!-- Course 1 -->
                    <div class="flex justify-between items-center p-4 border rounded-lg">
                        <div>
                            <strong class="block text-lg font-semibold text-slate-800">CSC 405: Artificial Intelligence</strong>
                            <span class="text-sm text-slate-500">Prerequisite: CSC 301</span>
                        </div>
                        <button id="btn-csc405" data-course="CSC 405" class="add-course-btn bg-green-600 text-white font-medium py-2 px-4 rounded-lg hover:bg-green-700 transition-colors">
                            Add
                        </button>
                    </div>
                    
                    <!-- Course 2 -->
                    <div class="flex justify-between items-center p-4 border rounded-lg">
                        <div>
                            <strong class="block text-lg font-semibold text-slate-800">CSC 407: Compiler Construction</strong>
                            <span class="text-sm text-slate-500">Prerequisite: CSC 303</span>
                        </div>
                        <button id="btn-csc407" data-course="CSC 407" class="add-course-btn bg-green-600 text-white font-medium py-2 px-4 rounded-lg hover:bg-green-700 transition-colors">
                            Add
                        </button>
                    </div>

                    <!-- Course 3 -->
                    <div class="flex justify-between items-center p-4 border rounded-lg">
                        <div>
                            <strong class="block text-lg font-semibold text-slate-800">GNS 101: Use of English</strong>
                            <span class="text-sm text-slate-500">Prerequisite: None</span>
                        </div>
                        <button id="btn-gns101" data-course="GNS 101" class="add-course-btn bg-green-600 text-white font-medium py-2 px-4 rounded-lg hover:bg-green-700 transition-colors">
                            Add
                        </button>
                    </div>
                </div>

                <!-- NEW: Placeholder for Semantic Net recommendations -->
                <div id="recommendation-box" class="mt-6"></div>

                <button id="back-button" class="mt-8 text-sm text-slate-500 hover:text-blue-600">&larr; Back to Dashboard</button>
            `;

            // --- NEW: Logic to update button states and show recommendations ---
            
            // Update button states based on what's already registered or passed
            updateButtonStates();

            // If AI was added, show the recommendation box
            if (student.registeredCourses.includes("CSC 405")) {
                const recBox = document.getElementById('recommendation-box');
                recBox.innerHTML = `
                    <button id="show-semantic-modal" class="w-full text-left p-4 rounded-lg border border-yellow-300 bg-yellow-50 hover:bg-yellow-100 hover:shadow-md focus:outline-none focus:ring-2 focus:ring-yellow-500 transition-all duration-150">
                        <strong class="block text-lg font-semibold text-yellow-800">Recommendations</strong>
                        <span class="text-sm text-yellow-700">Because you added AI, you might like Machine Learning or Data Mining. <strong>Click to see why.</strong></span>
                    </button>
                `;
                document.getElementById('show-semantic-modal').addEventListener('click', handleShowSemanticModal);
            }
            // --- END NEW LOGIC ---


            // Attach listeners for all "Add" buttons
            document.querySelectorAll('.add-course-btn').forEach(button => {
                button.addEventListener('click', (e) => handleAddCourse(e.target.dataset.course, e.target));
            });
            document.getElementById('back-button').addEventListener('click', renderDashboard);
        }
        
        /**
         * NEW: Updates button states on the course list page
         */
        function updateButtonStates() {
            const btn405 = document.getElementById('btn-csc405');
            const btn407 = document.getElementById('btn-csc407');
            const btn101 = document.getElementById('btn-gns101');

            // Check CSC 405
            if (student.registeredCourses.includes("CSC 405")) {
                styleButton(btn405, "Added", "disabled");
            }

            // Check CSC 407
            if (student.registeredCourses.includes("CSC 407")) {
                styleButton(btn407, "Added", "disabled");
            } 
            // REMOVED: else if (!student.passedCourses.includes(courses["CSC 407"].prereq)) { ... }
            // This logic was firing on page load, which was incorrect.
            // It should only fire on click, which handleAddCourse does.

            // Check GNS 101
            // REMOVED: if (student.passedCourses.includes("GNS 101")) { ... }
            // This logic was also firing on page load.
            // We want the user to click it and see *why* it fails.
            if (student.registeredCourses.includes("GNS 101")) {
                styleButton(btn101, "Added", "disabled");
            }
        }

        /**
         * NEW: Helper function to style buttons
         */
        function styleButton(button, text, state) {
            if (!button) return;
            button.textContent = text;
            button.disabled = true;
            button.classList.remove('bg-green-600', 'hover:bg-green-700', 'bg-red-500');
            
            if (state === "disabled") {
                button.classList.add('bg-slate-400', 'cursor-not-allowed');
            } else if (state === "failed") {
                button.classList.add('bg-red-500', 'cursor-not-allowed');
            }
        }
        
        /**
         * Renders the related courses (Semantic Net) step
         */
         function handleShowSemanticModal() {
            // Show the modal explaining this
            showModal(
                "KNOWLEDGE IN ACTION: 4. Semantic Networks",
                `
                <p><strong>How did the system know these courses were related?</strong></p>
                <p>It's not just a keyword match. It's navigating a "mind map" (a Semantic Network) that defines relationships.</p>
                <div class="font-mono text-sm bg-slate-100 p-3 rounded-md">
                    (AI) ---[has-subfield]---> (Machine Learning)
                    <br>
                    (AI) ---[uses-technique]---> (Data Mining)
                </div>
                <p>By traversing this graph, the system can make intelligent recommendations.</p>
                `
            );
         }


        // --- Event Handler Functions ---

        function handleLogin() {
            // Show the modal first
            showModal(
                "KNOWLEDGE IN ACTION: 1. Logic",
                `
                <p>The system just used <strong>Propositional Logic</strong> to authenticate you.</p>
                <p>It evaluated a formal, true/false statement:</p>
                <div class="font-mono text-sm bg-slate-100 p-3 rounded-md">
                    IF IsValid(User) AND CorrectPassword(User)
                    <br>
                    THEN GrantAccess = <strong>TRUE</strong>
                </div>
                <p>Like a "Legal Contract," the rule is rigid and unambiguous. Access is granted.</p>
                `
            );
            // Render the next screen (dashboard) after modal is closed
            // We can do this by attaching a one-time listener to the close button
            const onModalClose = () => {
                renderDashboard();
                modalClose.removeEventListener('click', onModalClose);
                modalCloseX.removeEventListener('click', onModalClose);
            };
            modalClose.addEventListener('click', onModalClose);
            modalCloseX.addEventListener('click', onModalClose);
        }

        function handleViewProfile() {
            // Show modal explaining the action
            showModal(
                "KNOWLEDGE IN ACTION: 3. Frames",
                `
                <p>The system just retrieved your student data using a <strong>Frame</strong>.</p>
                <p>A Frame is a "template" (like a digital baseball card) for a stereotyped object. Your profile is an <strong>instance</strong> of a 'Student' frame.</p>
                <div class="font-mono text-sm bg-slate-100 p-3 rounded-md">
                    <strong>Frame:</strong> Student_Profile
                    <br>
                    <strong>Slots:</strong>
                    <br>
                    - Name: "${student.name}"
                    <br>
                    - CGPA: ${student.cgpa}
                    <br>
                    - Status: "${student.status}"
                </div>
                <p>This groups related data together in a structured way.</p>
                `
            );
            // This action doesn't change the screen, just shows info.
        }

        function handleAddCourse(courseId, button) {
            const course = courses[courseId];
            
            // Check for prerequisite (the "Rule")
            if (course && student.passedCourses.includes(course.prereq)) {
                // SUCCESS
                student.registeredCourses.push(courseId); // Add to our list
                showModal(
                    "KNOWLEDGE IN ACTION: 2. Rules (IF-THEN)",
                    `
                    <p><strong class="text-green-600">SUCCESS:</strong> Course added.</p>
                    <p>The system's "Inference Engine" just checked its "Knowledge Base" of rules.</p>
                    <div class="font-mono text-sm bg-slate-100 p-3 rounded-md">
                        <strong>Rule:</strong> IF Prerequisite_Passed("${course.prereq}") THEN Allow_Registration.
                        <br>
                        <strong>Fact:</strong> Your transcript <strong>contains</strong> "${course.prereq}".
                        <br>
                        <strong>Result:</strong> TRUE.
                    </div>
                    `
                );
                
                // NEW: Re-render the course list when modal closes
                const onModalClose = () => {
                    renderCourseList();
                    modalClose.removeEventListener('click', onModalClose);
                    modalCloseX.removeEventListener('click', onModalClose);
                };
                modalClose.addEventListener('click', onModalClose);
                modalCloseX.addEventListener('click', onModalClose);


            } else if (courseId === "GNS 101") {
                // Check if already passed
                if (student.passedCourses.includes("GNS 101")) {
                     showModal(
                        "KNOWLEDGE IN ACTION: 2. Rules (IF-THEN)",
                        `
                        <p><strong class="text-red-600">FAILED:</strong> Course already passed.</p>
                        <p>The system's "Inference Engine" checked another rule.</p>
                        <div class="font-mono text-sm bg-slate-100 p-3 rounded-md">
                            <strong>Rule:</strong> IF Course_ID is in Student_Passed_Courses THEN Block_Registration.
                            <br>
                            <strong>Fact:</strong> Your transcript <strong>contains</strong> "GNS 101".
                            <br>
                            <strong>Result:</strong> TRUE. (Registration Blocked)
                        </div>
                        `
                    );
                    styleButton(button, "Passed", "disabled");
                } else {
                    // SUCCESS (No prereq)
                    student.registeredCourses.push(courseId); // Add to our list
                    showModal(
                        "KNOWLEDGE IN ACTION: 2. Rules (IF-THEN)",
                        `
                        <p><strong class="text-green-600">SUCCESS:</strong> Course added.</p>
                        <p>The system's "Inference Engine" checked its rules.</p>
                        <div class="font-mono text-sm bg-slate-100 p-3 rounded-md">
                            <strong>Rule:</strong> IF Prerequisite_Passed(None) THEN Allow_Registration.
                            <br>
                            <strong>Fact:</strong> The course has no prerequisite.
                            <br>
                            <strong>Result:</strong> TRUE.
                        </div>
                        `
                    );
                    // NEW: Re-render the course list when modal closes
                    const onModalClose = () => {
                        renderCourseList();
                        modalClose.removeEventListener('click', onModalClose);
                        modalCloseX.removeEventListener('click', onModalClose);
                    };
                    modalClose.addEventListener('click', onModalClose);
                    modalCloseX.addEventListener('click', onModalClose);
                }
                
            } else {
                // FAILURE
                showModal(
                    "KNOWLEDGE IN ACTION: 2. Rules (IF-THEN)",
                    `
                    <p><strong class="text-red-600">FAILED:</strong> Prerequisite not met.</p>
                    <p>The system's "Inference Engine" just checked its "Knowledge Base" of rules.</p>
                    <div class="font-mono text-sm bg-slate-100 p-3 rounded-md">
                        <strong>Rule:</strong> IF Prerequisite_Passed("${course.prereq}") THEN Allow_Registration.
                        <br>
                        <strong>Fact:</strong> Your transcript <strong>does not contain</strong> "${course.prereq}".
                        <br>
                        <strong>Result:</strong> FALSE.
                    </div>
                    `
                );
                styleButton(button, "Failed", "failed");
            }
        }

        function handleGraduationCheck() {
            showModal(
                "KNOWLEDGE IN ACTION: 5. Ontologies",
                `
                <p><strong class="text-red-600">STATUS:</strong> Pending Senate Approval.</p>
                <p>This check uses an <strong>Ontology</strong>, the most formal KR. It's a "dictionary of everything" for the university, defining concepts and the <strong>strict rules governing their existence.</strong></p>
                <div class="font-mono text-sm bg-slate-100 p-3 rounded-md">
                    <strong>Concept:</strong> Student, Lecturer, HOD, Senate
                    <br>
                    <strong>Hierarchy:</strong> An 'HOD' is-a 'Lecturer'.
                    <br>
                    <strong>Strict Rule:</strong> (Approve_Graduation(Lecturer)) is <strong>NOT_ALLOWED</strong>.
                    <br>
                    <strong>Strict Rule:</strong> (Approve_Graduation(Senate)) is <strong>ALLOWED</strong>.
                </div>
                <p>The ontology ensures that a 'Lecturer' cannot approve graduation because the formal model of the university forbids it. It's the "constitution" of the system.</p>
                `
            );
        }

        // --- Initial Render ---
        renderLogin();
        
    </script>
</body>
</html>
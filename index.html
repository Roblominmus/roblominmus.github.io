<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BE SUPERIOR</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>

    <div class="app">
        <!-- Header -->
        <header class="header">
            <div class="header-top">
                <div class="app-title">BE SUPERIOR</div>
                <button class="theme-toggle" id="themeBtn" aria-label="Toggle Theme">
                    <svg viewBox="0 0 24 24"><path d="M12 22c5.523 0 10-4.477 10-10S17.523 2 12 2 2 6.477 2 12s4.477 10 10 10zm0-2V4a8 8 0 1 1 0 16z"/></svg>
                </button>
            </div>
            <div class="date-display" id="dateDisplay">Loading...</div>
        </header>

        <!-- Day Navigation -->
        <nav class="day-nav" id="dayNav"></nav>

        <!-- Main Content Area -->
        <main class="main-content" id="mainContent"></main>
    </div>

    <!-- Modal System -->
    <div class="modal-overlay" id="modalOverlay">
        <div class="modal-container">
            <div class="modal-header">
                <button class="modal-btn back hidden" id="modalBackBtn">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M15 18l-6-6 6-6"/></svg>
                    Back
                </button>
                <div class="modal-title" id="modalTitle">Title</div>
                <button class="modal-btn" id="modalCloseBtn">Done</button>
            </div>
            <div class="modal-body" id="modalBody">
                <!-- Dynamic Content -->
            </div>
        </div>
    </div>

<script>
// --- Data Source ---
// Using template literals (backticks) to prevent syntax errors with newlines
const data = {
  "schedule_blocks": {
    "monday": [
      { "time": "08:00 AM - 05:00 PM", "activity": "Work (Office)", "details": "Standard office hours. Focus on tasks." },
      { "time": "06:00 PM - 07:00 PM", "activity": "Rest & Get Bearings", "details": "Transition time. Decompress from office." },
      { "time": "07:00 PM - 07:25 PM", "activity": "Workout: Light Recovery (Home)", "type": "gym", "routine": "light_recovery", "details": "Short and restorative to fit post-office fatigue." },
      { "time": "08:30 PM - 10:30 PM", "activity": "Cyber Security Time", "type": "cyber", "details": "Focus on Phase 0: Foundational DevOps." }
    ],
    "tuesday": [
      { "time": "07:00 AM - 09:00 AM", "activity": "Gym: Strength & Pulling", "type": "gym", "routine": "strength_pulling", "details": "75 mins total including travel/buffer. Back home/showered by 9:30 AM to start work comfortably." },
      { "time": "09:00 AM - 05:00 PM", "activity": "Work (WFH)", "details": "Work from home. Stand up periodically." },
      { "time": "05:00 PM - 06:00 PM", "activity": "Rest & Get Bearings", "details": "Mental reset before evening study." },
      { "time": "06:00 PM - 08:00 PM", "activity": "Cyber Security Time", "type": "cyber", "details": "Focus on Phase 1: Offensive API Security." }
    ],
    "wednesday": [
      { "time": "08:00 AM - 05:00 PM", "activity": "Work (Office)", "details": "Standard office hours." },
      { "time": "06:00 PM - 07:00 PM", "activity": "Rest & Get Bearings", "details": "Transition time." },
      { "time": "07:00 PM - 07:25 PM", "activity": "Workout: Light Recovery (Home)", "type": "gym", "routine": "light_recovery", "details": "Short and restorative to fit post-office fatigue." },
      { "time": "08:30 PM - 10:30 PM", "activity": "Cyber Security Time", "type": "cyber", "details": "Continue Phase 0 or 1 labs." }
    ],
    "thursday": [
      { "time": "07:00 AM - 09:00 AM", "activity": "Gym: Combat Conditioning", "type": "gym", "routine": "combat_conditioning", "details": "75 mins total, back by 9:30 AM." },
      { "time": "09:00 AM - 05:00 PM", "activity": "Work (WFH)", "details": "Work from home." },
      { "time": "05:00 PM - 06:00 PM", "activity": "Rest & Get Bearings", "details": "Mental reset." },
      { "time": "06:00 PM - 08:00 PM", "activity": "Cyber Security Time", "type": "cyber", "details": "Phase 1.5: VDP Hunt or Lab Project." }
    ],
    "friday": [
      { "time": "07:00 AM - 08:00 AM", "activity": "Workout: Light Recovery (Home)", "type": "gym", "routine": "light_recovery", "details": "25 mins—quick morning session before work start." },
      { "time": "09:00 AM - 05:00 PM", "activity": "Work (WFH)", "details": "Work from home. Wrap up weekly tasks." },
      { "time": "05:00 PM - 06:00 PM", "activity": "Rest & Get Bearings", "details": "End of work week transition." },
      { "time": "Evening", "activity": "Cyber Security Time", "type": "cyber", "details": "Flexible time for Labs or Capstone." }
    ],
    "saturday": [
      { "time": "07:00 AM - 09:30 AM", "activity": "Gym: Agility & Skill Synthesis", "type": "gym", "routine": "agility_skill", "details": "90 mins total, flexible end time since no work constraint." },
      { "time": "11:00 AM - 03:00 PM", "activity": "Cyber Security Time", "type": "cyber", "details": "Long session: Deep work on Capstone or VDP." }
    ],
    "sunday": [
      { "time": "Morning - 12:00 PM", "activity": "Church", "details": "Weekly reset." },
      { "time": "12:00 PM - End of Day", "activity": "Rest", "details": "Total rest—no workouts, prioritize sleep/recovery for weekly reset." }
    ]
  },
  "gym_data": {
    "warmup": {
      "title": "Standard Warm-Up",
      "duration": "10 mins",
      "description": "Mandatory before every session: Builds mobility/agility baseline safely, preps for all goals without clashing schedules.",
      "exercises": [
        { "name": "Light Cardio", "duration": "3 mins", "form": "Jog in place or jumping jacks. Steady pace to break sweat.", "why": "Elevates heart rate for endurance/sprint readiness, adaptable home/gym.", "video": "https://www.youtube.com/watch?v=BsZmSx34hvQ" },
        { "name": "Neck CARs", "reps": "5 circles/direction", "form": "Slow, controlled rotations.", "why": "Enhances head movement/clarity for chase/combat memorization.", "video": "https://www.youtube.com/watch?v=BsZmSx34hvQ" },
        { "name": "Cat-Cow", "reps": "10 reps", "form": "On all fours, arch/round back with breath.", "why": "Spine mobility for balance in climbs/carries.", "video": "https://www.youtube.com/watch?v=Xq3nUS-Y2q4" },
        { "name": "Shoulder Dislocates", "reps": "10 reps", "form": "Wide grip, over-and-back (Band/Towel).", "why": "Shoulder range for pulling/punching in self-protection.", "video": "https://www.youtube.com/watch?v=7p-Ma0eksaY" },
        { "name": "World's Greatest Stretch", "reps": "5/side, 5s hold", "form": "Lunge forward, twist torso.", "why": "Opens hips for agility/momentum shifts.", "video": "https://www.youtube.com/watch?v=-CiWQ2IvY34" },
        { "name": "Leg Swings", "reps": "10 fwd/back + side/side", "form": "Controlled swings.", "why": "Loosens legs for sprints/labor demands.", "video": "https://www.youtube.com/watch?v=difDswSWOc4" },
        { "name": "Bodyweight Squats", "reps": "15 reps", "form": "Feet shoulder-width, sit back, knees track toes.", "why": "Primes lower body/core for strength/endurance.", "video": "https://www.youtube.com/watch?v=P-yaD24bUE8" }
      ]
    },
    "routines": {
      "light_recovery": {
        "title": "Light Recovery",
        "description": "Goal: Healing/mobility focus—supports quick recovery for multiple efforts, fits office evenings/WFH mornings without strain. (25 mins total)",
        "warmup": true,
        "circuit": [
          { "name": "Bird-Dogs", "reps": "10/side, hold 5 secs", "form": "Extend opposite arm/leg, hips level, core braced.", "why": "Builds core stability for balance in chases/climbs.", "video": "https://www.youtube.com/watch?v=wiFNA3sqjCA" },
          { "name": "Side Plank", "reps": "20 secs/side", "form": "Straight body line, no hip sag.", "why": "Obliques for anti-rotation in fights/carries.", "video": "https://www.youtube.com/watch?v=XeN4pEZZJNI" },
          { "name": "Glute Bridges", "reps": "15 reps", "form": "Feet flat, lift hips squeezing glutes, drive through heels.", "why": "Glute activation for sprint/power in labor.", "video": "https://www.youtube.com/watch?v=wPM8icPu6H8" },
          { "name": "Couch Stretch", "reps": "45-60 secs/side", "form": "Knee down, foot against wall, lean forward.", "why": "Releases hips for better running/agility.", "video": "https://www.youtube.com/watch?v=kRSUZPsqBQg" },
          { "name": "Figure-Four Stretch", "reps": "45-60 secs/side", "form": "Cross ankle over knee, pull thigh in.", "why": "Eases glutes for endurance/labor resilience.", "video": "https://www.youtube.com/watch?v=OcfcKXTaEkA" }
        ]
      },
      "strength_pulling": {
        "title": "Strength & Pulling Focus",
        "description": "Goal: Raw functional strength for labor/carrying/climbing/combat—directly builds grip/resilience for jerrycans/barrows/holding off attackers. (75 mins)",
        "warmup": true,
        "exercises": [
          { "name": "Barbell Back Squats", "sets": "4 x 6-8", "rest": "2 mins", "form": "Bar on upper back, feet shoulder-width, descend to parallel with core braced, drive up through heels.", "why": "Leg/core power for sustained labor/sprints over 1-2km. Progress: Add weight when 2 reps in reserve.", "video": "https://www.youtube.com/watch?v=U3HlLHzX6Lg" },
          { "name": "Bent-Over Barbell Rows", "sets": "4 x 6-8", "rest": "2 mins", "form": "Hinge hips, flat back, pull bar to lower ribs, squeeze shoulder blades.", "why": "Back pulling strength for climbing/ledges/bodyweight pulls. Progress: Add weight at full reps with control.", "video": "https://www.youtube.com/watch?v=TJiouaKew_k" },
          { "name": "Dumbbell Floor Press", "sets": "4 x 6-8", "rest": "90 secs", "form": "Lie on floor, press from chest, elbows at 45 degrees.", "why": "Pushing toughness for self-protection in 4v1 scenarios. Progress: Increase weight gradually.", "video": "https://www.youtube.com/watch?v=AqYFvc9t_vU" },
          { "name": "Push-Ups", "sets": "3 x max", "rest": "60 secs", "form": "Straight body, chest to floor, full range.", "why": "Additional upper body pushing resilience for combat or pushing obstacles.", "video": "https://www.youtube.com/watch?v=IODxDxX7oi4" },
          { "name": "Farmers Walk", "sets": "2 sets", "details": "Heavy weights, 40m walk.", "form": "Upright posture, tight grip.", "why": "Grip/endurance for carrying loads without failure.", "video": "https://www.youtube.com/watch?v=lLAw6fUccKA" },
          { "name": "Band Pull-Aparts", "sets": "2 sets x 15 reps", "form": "Hold band at chest, pull apart to sides.", "why": "Shoulder health/toughness for repeated efforts.", "video": "https://www.youtube.com/watch?v=smSSXITNpCI" }
        ]
      },
      "combat_conditioning": {
        "title": "Combat Conditioning & Sprint",
        "description": "Goal: Fight stamina/sprint capacity—trains for chases (2-3km sprint, 10km jog) and holding off attackers with clarity/recovery. (75 mins)",
        "warmup": true,
        "exercises": [
          { "name": "Punching Bag Intervals", "sets": "8 rounds", "details": "20 mins total. 30 secs all-out combos, 90 secs active rest (light footwork).", "form": "Hands up, pivot feet, move head.", "why": "Power/mental toughness for 4v1 deterrence/escape.", "video": "https://www.youtube.com/watch?v=Rlj3SWFu3I0" },
          { "name": "Treadmill Intervals", "sets": "20 mins", "details": "Weeks 1-4: 400m hard run, 90 secs walk x6; progress to 600m (5-8), 800m (9-12).", "form": "Controlled pace, upright posture.", "why": "Builds sustained effort for escapes/long distances.", "video": "https://www.youtube.com/watch?v=ufh3SWOc4oM" },
          { "name": "Farmers Holds (Grip Finisher)", "sets": "3 x 30 secs", "details": "Heaviest weight.", "form": "Static hold, no drop.", "why": "Resilient grip for labor/confrontations.", "video": "https://www.youtube.com/watch?v=h3I-fD7RYgE" }
        ]
      },
      "agility_skill": {
        "title": "Agility & Skill Synthesis",
        "description": "Goal: Integrate skills under fatigue—mimics real-world survival (multi-attacker, labor, climbs) for adaptability/body control. (90 mins)",
        "warmup": true,
        "exercises": [
          { "name": "Extended Warm-Up", "details": "Standard + 5 mins shadow boxing footwork.", "form": "Light, controlled footwork.", "why": "Agility/mental clarity." },
          { "name": "Inverted Rows (Skill Drill)", "details": "10 mins practice.", "form": "Pull chest to bar, slow 5-sec negative lower, body straight.", "why": "Bodyweight pulling for ledges/hanging emergencies.", "video": "https://www.youtube.com/watch?v=I640fMJC80s" },
          { "name": "Carries (Skill Drill)", "details": "10 mins heavy (Suitcase/Front Rack).", "form": "Balanced walk, core tight.", "why": "Dexterity/grip for jerrycans/barrows over distance.", "video": "https://www.youtube.com/watch?v=y-hn_Ha1-RE" },
          { "name": "Capacity Challenge (AMRAP)", "details": "15-20 mins. 15 Inverted Rows, 20 Bag Slams, 400m Run, 15 Barbell Back Squats. Rest 2 mins after full circuit.", "form": "Maintain technique under fatigue.", "why": "Stop-start demands for protection/labor scenarios.", "video": "https://www.youtube.com/watch?v=w7e6KD9tvHo" },
          { "name": "Cool-Down", "duration": "15 mins", "form": "Full-body stretches.", "video": "https://www.youtube.com/watch?v=itJE4neqDJw" }
        ]
      }
    }
  },
  "cyber_content_database": {
    "phases": [
      {
        "id": "0",
        "title": "Foundational DevOps & Server Admin",
        "description": "Why: To fix your self-admitted weakness. This phase builds the \"terminal muscle memory\" required to operate in the headless (non-GUI) Linux environments where all professional targets (servers, APIs, containers) reside.",
        "tasks": [
          {
            "name": "Skill: Terminal & Git Fluency",
            "type": "Skill",
            "details": `What: Mastering core Linux and Git commands until they are muscle memory.
How to Practice ($0):
- Linux (Practice): Finish all levels of OverTheWire: Bandit. This is your #1 priority for core commands.
- Git (Practice): Create a GitHub repo. Practice the full workflow: git clone, git add ., git commit -m "msg", git push. Do this 20 times.
- Git (Learn): Use the Git Tower (Free Book) for a clear guide.`,
            "deliverable": "A GitHub repository with a 100-commit history (even if just text files) to build muscle memory.",
            "done": "Definition of Done: You can finish a Bandit level and `git push` your notes without looking up the commands."
          },
          {
            "name": "Project 1: Python Log Analyzer",
            "type": "Project",
            "details": `What: Turning a simple Bash one-liner into a professional, reusable Python tool. Demonstrates "Text-Fu" and practical scripting.
How to Practice ($0):
- Service Mgmt: On Debian VM, install Nginx. Control it (systemctl).
- Log Analysis: Read DigitalOcean grep/awk/sed Guide.
- Lab: TryHackMe 'Tinkerbell' Room.
- Python: Learn argparse and re modules.`,
            "deliverable": "A new GitHub repo `log-analyzer.py`. Must use argparse (-f) and regex to parse Nginx log to JSON.",
            "done": "Definition of Done: Script runs from CLI, parses real /var/log/nginx/access.log, and prints clean JSON report."
          }
        ]
      },
      {
        "id": "1",
        "title": "Offensive API Security & Tooling",
        "description": "Why: To build your core specialization. This phase pivots from generic web hacking to the high-demand field of API-specific vulnerabilities.",
        "tasks": [
          {
            "name": "Skill: API Hacking (Offensive Theory)",
            "type": "Skill",
            "details": `What: Master OWASP API Top 10. Focus on Business Logic Flaws: API1 (BOLA), API5 (BFLA), API2 (Broken Auth).
How to Practice ($0):
- Study: Read OWASP API Top 10 Project docs.
- Practice (Mandatory): Complete all labs in PortSwigger Academy "API Security" module.
- Practice (Tools): Use Postman and Burp Suite Community.
- Lab: Explore vAPI (Vulnerable API) project.`,
            "deliverable": "A document in your GitHub repo (API_NOTES.md) explaining BOLA, BFLA, and Broken Auth in your own words.",
            "done": "Definition of Done: Completed all Practitioner-level API security labs in PortSwigger Academy and can explain BOLA by heart."
          },
          {
            "name": "Project 2: API Pentest Toolkit",
            "type": "Project",
            "details": `What: Building an extensible Python toolkit.
How to Practice ($0):
- Learn: Read requests library docs.
- Project: Build reusable Python script (api-toolkit.py) using argparse.
- Start with module_bola (iterates IDs).
- Add module_discovery (wordlist finder).`,
            "deliverable": "New GitHub repo `api-pentest-toolkit` containing finished, modular tool. README.md explaining usage.",
            "done": "Definition of Done: Working, reusable Python script that runs at least two different 'attack modules' selected via CLI."
          }
        ]
      },
      {
        "id": "1.5",
        "title": "The 'Real World' VDP Hunt",
        "description": "Why: To validate skills on real infrastructure without competing against elite hackers. Focus on VDPs to build portfolio.",
        "tasks": [
          {
            "name": "Skill: Strategic VDP Selection",
            "type": "Strategy",
            "details": `What: Finding targets not saturated by automation.
How to Practice ($0):
- Avoid Front Page: Don't pick top HackerOne programs.
- Find VDPs: Search for 'Vulnerability Disclosure Programs' offering Thanks/Swag (not cash).
- Self-Hosted: Look for self-managed programs on company websites.`,
            "deliverable": "A list of 3 low-competition VDP targets.",
            "done": "Definition of Done: You have selected ONE specific VDP target for the next step."
          },
          {
            "name": "Project: The 14-Day Deep Dive",
            "type": "Execution",
            "details": `What: Applying 'Pattern Recognition' to a single target.
The Routine:
- Rule: Stick to ONE target for 2 weeks.
- Daily: 2 hours study feature, 2-3 hours active hunting.
- Focus: Map business logic. Look for where patterns (IDOR/BOLA) should exist.`,
            "deliverable": "A valid vulnerability report (even P4/Low) or a detailed 'Attack Surface Map'.",
            "done": "Definition of Done: You have spent 14 days on one target and understand its business logic better than the developers."
          }
        ]
      },
      {
        "id": "2",
        "title": "SDLC & Target Creation",
        "description": "Why: To learn the 'Build It' part. You will build your own vulnerable target to understand a developer's logic.",
        "tasks": [
          {
            "name": "Project 3: Build a Multi-Vuln API Lab",
            "type": "Project",
            "details": `What: Use Python Flask to create REST API with /login and user endpoints. Deliberately code flaws.
How to Practice ($0):
- Learn: Flask Quickstart docs.
- Flaw 1 (BOLA): /users/<id> endpoint must not check login match.
- Flaw 2 (BFLA): /admin/all_users checks login but not role.
- Flaw 3 (Mass Assignment): PATCH /profile allows updating "is_admin": true.`,
            "deliverable": "New GitHub repo `multi-vuln-api-lab` with source code.",
            "done": "Definition of Done: API runs locally and is demonstrably vulnerable to BOLA, BFLA, and Mass Assignment."
          },
          {
            "name": "Skill: Containerize Your Target",
            "type": "DevOps",
            "details": `What: Package your vulnerable API using Docker.
How to Practice ($0):
- Learn: Docker 'Get Started'.
- Project: Write Dockerfile and docker-compose.yml.`,
            "deliverable": "Dockerfile and docker-compose.yml committed to repo.",
            "done": "Definition of Done: Vulnerable API runs successfully from a Docker container using `docker compose up`."
          }
        ]
      },
      {
        "id": "3",
        "title": "Custom Exploit Dev & Reporting",
        "description": "Why: To learn the 'Break It' part. Write custom exploit and document it professionally.",
        "tasks": [
          {
            "name": "Skill: Custom Multi-Exploit Scripting",
            "type": "Exploit",
            "details": `What: Adapt api-pentest-toolkit or write new exploit.py to find all 3 vulnerabilities.
How to Practice ($0):
- Script: Login as low-privilege user.
- Exploit:
  1. Exploit BOLA to read user_B data.
  2. Exploit BFLA to access /admin.
  3. Exploit Mass Assignment to become admin.`,
            "deliverable": "README.md with 'Exploitation Steps' and finished exploit.py.",
            "done": "Definition of Done: exploit.py successfully exploits all three vulnerabilities."
          },
          {
            "name": "Project 4: Professional Vulnerability Report",
            "type": "Documentation",
            "details": `What: Creating a high-quality PDF report.
Content:
1. Executive Summary.
2. Technical Findings (one per bug).
3. Proof of Concept (exploit code/output).
4. Remediation (how to fix).`,
            "deliverable": "High-quality Vulnerability_Report.pdf committed to repo.",
            "done": "Definition of Done: Professional PDF report clearly explaining risk, impact, and solution."
          }
        ]
      },
      {
        "id": "4",
        "title": "Standalone Project - JWT Security Lab",
        "description": "Why: To tackle API2: Broken Authentication (JWT).",
        "tasks": [
          {
            "name": "Skill: Build & Break a JWT API",
            "type": "Project",
            "details": `What: Use Flask and PyJWT to build API with JWT flaws.
How to Practice ($0):
- Build: /login (issues JWT) and /protected.
- Flaw 1 (alg:none): /protected accepts alg:none.
- Flaw 2 (Weak Secret): Use 'secret123'.
- Break: Write jwt_attacker.py to forge token and brute-force secret.`,
            "deliverable": "New repo `jwt-security-lab` with API source and attacker script.",
            "done": "Definition of Done: Attacker script gains admin access via both flaws."
          },
          {
            "name": "Skill: Secure the JWT API",
            "type": "Defense",
            "details": `What: Fixing the flaws.
How to Practice ($0):
- Secure: Create branch 'patched'.
- Fix 1: Only accept HS256.
- Fix 2: Use complex key.
- Verify: Attacker script must fail.`,
            "deliverable": "Patched branch with README explaining fixes.",
            "done": "Definition of Done: Exploit works on main but fails on patched branch."
          }
        ]
      },
      {
        "id": "5",
        "title": "Capstone - Exploit-Verified CI/CD",
        "description": "Why: Tie everything into one 'Resume Weapon'. Build, Break, Secure lifecycle.",
        "tasks": [
          {
            "name": "Project: The 'Build, Break, Secure' Pipeline",
            "type": "DevOps",
            "details": `What: GitHub Actions pipeline running exploit script.
Steps:
1. Build Action: .github/workflows/security_test.yml. Build container, run exploit.py.
2. Break: Push vulnerable code. Pipeline MUST fail (RED).
3. Secure: Create branch 'patched', fix code.
4. Proof: Push patched code. Pipeline MUST pass (GREEN).`,
            "deliverable": "GitHub URL showing clear history of RED and GREEN builds.",
            "done": "Definition of Done: GitHub Action turns RED on main and GREEN on patched."
          }
        ]
      }
    ]
  }
};

// --- State & DOM Elements ---
const days = ['sunday', 'monday', 'tuesday', 'wednesday', 'thursday', 'friday', 'saturday'];
let currentDay = days[new Date().getDay()];
let modalHistory = [];

const elems = {
    themeBtn: document.getElementById('themeBtn'),
    dateDisplay: document.getElementById('dateDisplay'),
    dayNav: document.getElementById('dayNav'),
    mainContent: document.getElementById('mainContent'),
    modal: {
        overlay: document.getElementById('modalOverlay'),
        title: document.getElementById('modalTitle'),
        body: document.getElementById('modalBody'),
        backBtn: document.getElementById('modalBackBtn'),
        closeBtn: document.getElementById('modalCloseBtn')
    }
};

// --- Theme Management ---
let theme = localStorage.getItem('theme') || 'light';
document.documentElement.setAttribute('data-theme', theme);
elems.themeBtn.addEventListener('click', () => {
    theme = theme === 'dark' ? 'light' : 'dark';
    document.documentElement.setAttribute('data-theme', theme);
    localStorage.setItem('theme', theme);
});

// --- Modal System with Navigation ---
function openModal(title, contentHTML, isBack = false) {
    if (!isBack && elems.modal.overlay.classList.contains('active')) {
        modalHistory.push({
            title: elems.modal.title.textContent,
            body: elems.modal.body.innerHTML
        });
    } else if (!isBack) {
        modalHistory = [];
    }

    elems.modal.title.textContent = title;
    elems.modal.body.innerHTML = contentHTML;
    
    if (modalHistory.length > 0) {
        elems.modal.backBtn.classList.remove('hidden');
    } else {
        elems.modal.backBtn.classList.add('hidden');
    }

    elems.modal.overlay.classList.add('active');
    document.body.style.overflow = 'hidden';
}

function goBack() {
    if (modalHistory.length === 0) return;
    const prevState = modalHistory.pop();
    openModal(prevState.title, prevState.body, true);
}

function closeModal() {
    elems.modal.overlay.classList.remove('active');
    document.body.style.overflow = '';
    modalHistory = [];
    setTimeout(() => { elems.modal.body.innerHTML = ''; }, 300);
}

elems.modal.closeBtn.addEventListener('click', closeModal);
elems.modal.backBtn.addEventListener('click', goBack);
elems.modal.overlay.addEventListener('click', (e) => {
    if (e.target === elems.modal.overlay) closeModal();
});

// --- Utilities ---
function getYouTubeID(url) {
    if (!url) return null;
    const regExp = /^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|&v=)([^#&?]*).*/;
    const match = url.match(regExp);
    return (match && match[2].length === 11) ? match[2] : null;
}

function parseTime(timeStr) {
    if (!timeStr) return -1;
    // Handle "Evening" or vague times
    if (timeStr.toLowerCase().includes('evening')) return 18 * 60; // 6 PM
    if (timeStr.toLowerCase().includes('morning')) return 8 * 60; // 8 AM
    
    const match = timeStr.match(/(\d+):?(\d*)\s*(AM|PM)/i);
    if (!match) return -1;
    let [_, h, m, p] = match;
    h = parseInt(h);
    m = m ? parseInt(m) : 0;
    if (p.toUpperCase() === 'PM' && h !== 12) h += 12;
    if (p.toUpperCase() === 'AM' && h === 12) h = 0;
    return h * 60 + m;
}

function isCurrentTime(timeRange) {
    if (!timeRange) return false;
    const now = new Date();
    if (days[now.getDay()] !== currentDay) return false;
    
    const currentMinutes = now.getHours() * 60 + now.getMinutes();
    
    // Handle special "Evening" case
    if (timeRange === "Evening") {
        return currentMinutes >= (18 * 60); // After 6 PM
    }
    
    if (!timeRange.includes('-')) return false;

    const parts = timeRange.split('-').map(s => s.trim());
    let start = parseTime(parts[0]);
    let end = parseTime(parts[1]);
    
    // Handle "End of Day"
    if (parts[1].toLowerCase().includes("end of day")) end = 24 * 60;
    
    if (start === -1) return false;
    if (end === -1) end = start + 60; // Default 1 hour if parse fails
    
    if (end < start) return currentMinutes >= start || currentMinutes < end;
    return currentMinutes >= start && currentMinutes < end;
}

// --- Render Logic ---
function renderDayNav() {
    elems.dayNav.innerHTML = '';
    const todayIndex = new Date().getDay();
    
    days.forEach((day, index) => {
        const btn = document.createElement('button');
        btn.className = `day-pill ${day === currentDay ? 'active' : ''} ${index === todayIndex ? 'today-highlight' : ''}`;
        btn.textContent = day.charAt(0).toUpperCase() + day.slice(1, 3);
        
        btn.addEventListener('click', () => {
            currentDay = day;
            renderDayNav();
            renderMainContent();
            btn.scrollIntoView({ behavior: 'smooth', block: 'nearest', inline: 'center' });
        });
        
        elems.dayNav.appendChild(btn);
    });

    const dateObj = new Date();
    const dayName = currentDay.charAt(0).toUpperCase() + currentDay.slice(1);
    elems.dateDisplay.textContent = currentDay === days[todayIndex] 
        ? `${dayName}, ${dateObj.toLocaleDateString()}` 
        : `Viewing ${dayName}`;
}

function renderMainContent() {
    let html = '<div class="animate-in">';
    
    const schedule = data.schedule_blocks[currentDay];
    
    if (schedule && schedule.length > 0) {
        // Schedule is the main page now
        html += '<div class="section-header">Daily Schedule</div><div class="card">';
        schedule.forEach(item => {
            const isCurrent = isCurrentTime(item.time);
            // Every item is clickable now
            html += `
                <div class="list-item ${isCurrent ? 'current-highlight' : ''}" onclick='openScheduleDetail(${JSON.stringify(item)})'>
                    <div class="list-item-content">
                        <div class="item-primary">${item.time}</div>
                        <div class="item-secondary">${item.activity}</div>
                    </div>
                    <div class="chevron">›</div>
                </div>
            `;
        });
        html += '</div>';
    } else {
        html += '<div class="card"><div class="list-item"><div class="list-item-content">No schedule items for today.</div></div></div>';
    }

    elems.mainContent.innerHTML = html;
}

function openScheduleDetail(item) {
  // If it's a gym item, open the specific routine
  if (item.type === 'gym') {
    const routineKey = item.routine;
    let routine = data.gym_data.routines[routineKey];
    
    // Check if we need to include standard warm up
    if (routine) {
        openRoutine(routineKey, routine);
    } else {
        // Fallback for general workout info
        openGenericDetail(item);
    }
  } 
  // If it's cyber, open the Cyber Path list
  else if (item.type === 'cyber') {
      openPhaseList();
  } 
  // Otherwise just show the details text
  else {
      openGenericDetail(item);
  }
}

function openGenericDetail(item) {
    let html = '<div class="card" style="padding: 20px;">';
    html += `
        <div class="detail-group">
            <div class="detail-label">Activity</div>
            <div class="detail-value" style="font-weight: 600;">${item.activity}</div>
        </div>
        <div class="detail-group">
            <div class="detail-label">Time</div>
            <div class="detail-value">${item.time}</div>
        </div>
        <div class="detail-group">
            <div class="detail-label">Details</div>
            <div class="detail-value">${item.details || 'No additional details.'}</div>
        </div>
    `;
    html += '</div>';
    openModal("Activity Details", html);
}

// --- Specific Modal Renderers ---

function openRoutine(key, routine) {
    let html = '';
    
    // Header Info
    html += `<div class="card" style="padding: 16px; margin-bottom: 16px;">
        <div class="detail-label">Goal</div>
        <div class="detail-value" style="font-size: 14px; margin-bottom: 8px;">${routine.description}</div>
    </div>`;

    // Standard Warmup Section (if applicable)
    if (routine.warmup) {
         html += '<div class="section-header">Warm-Up (Mandatory)</div>';
         html += '<div class="card" style="background: transparent;">';
         const warmup = data.gym_data.warmup;
         warmup.exercises.forEach((ex, idx) => {
             html += `
            <div class="list-item" style="background: var(--card-bg); margin-bottom: 1px; ${idx === 0 ? 'border-top-left-radius: 12px; border-top-right-radius: 12px;' : ''} ${idx === warmup.exercises.length - 1 ? 'border-bottom-left-radius: 12px; border-bottom-right-radius: 12px;' : ''}" onclick='event.stopPropagation(); openExercise(${JSON.stringify(ex)})'>
                <div class="list-item-content">
                    <div class="item-primary">${ex.name}</div>
                    <div class="item-secondary">${ex.duration || ex.reps}</div>
                </div>
                <div class="chevron">›</div>
            </div>`;
         });
         html += '</div>';
    }

    // Main Workout Section
    const exercises = routine.circuit || routine.exercises;
    html += `<div class="section-header">${routine.circuit ? 'Circuit' : 'Main Workout'}</div>`;
    html += '<div class="card" style="background: transparent;">';
    
    exercises.forEach((ex, idx) => {
        html += `
            <div class="list-item" style="background: var(--card-bg); margin-bottom: 1px; ${idx === 0 ? 'border-top-left-radius: 12px; border-top-right-radius: 12px;' : ''} ${idx === exercises.length - 1 ? 'border-bottom-left-radius: 12px; border-bottom-right-radius: 12px;' : ''}" onclick='event.stopPropagation(); openExercise(${JSON.stringify(ex)})'>
                <div class="list-item-content">
                    <div class="item-primary">${ex.name}</div>
                    <div class="item-secondary">${ex.reps || ex.sets || ex.duration || ex.details || 'View Details'}</div>
                </div>
                <div class="chevron">›</div>
            </div>
        `;
    });
    html += '</div>';
    
    openModal(routine.title, html);
}

function openExercise(ex) {
    let html = '<div class="animate-in">';
    
    if (ex.video) {
        const videoId = getYouTubeID(ex.video);
        if (videoId) {
            html += `
                <div class="video-wrapper">
                    <iframe src="https://www.youtube.com/embed/${videoId}" allowfullscreen></iframe>
                </div>
            `;
        }
    }

    html += '<div class="card" style="padding: 20px;">';
    
    const fields = [
        { label: 'Reps/Time', val: ex.reps || ex.sets || ex.duration },
        { label: 'Rest', val: ex.rest },
        { label: 'Form', val: ex.form },
        { label: 'Why', val: ex.why },
        { label: 'Details', val: ex.details }
    ];

    fields.forEach(f => {
        if (f.val) {
            html += `
                <div class="detail-group">
                    <div class="detail-label">${f.label}</div>
                    <div class="detail-value">${f.val}</div>
                </div>
            `;
        }
    });

    html += '</div></div>';
    openModal(ex.name, html);
}

function openPhaseList() {
    let html = '<div class="card" style="background: transparent;">';
    data.cyber_content_database.phases.forEach((phase, idx) => {
        html += `
            <div class="list-item" style="background: var(--card-bg); margin-bottom: 1px; ${idx===0?'border-top-left-radius:12px;border-top-right-radius:12px;':''} ${idx===data.cyber_content_database.phases.length-1?'border-bottom-left-radius:12px;border-bottom-right-radius:12px;':''}" onclick='openPhase(${JSON.stringify(phase)})'>
                <div class="list-item-content">
                    <div class="item-primary">Phase ${phase.id}: ${phase.title}</div>
                    <div class="item-secondary" style="font-size: 12px; opacity: 0.8; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden;">${phase.description}</div>
                </div>
                <div class="chevron">›</div>
            </div>
        `;
    });
    html += '</div>';
    openModal('Cyber Security Plan', html);
}

function openPhase(phase) {
    let html = `<div class="card" style="padding: 16px; margin-bottom: 16px;">
        <div class="detail-label">Phase Goal</div>
        <div class="detail-value" style="font-size: 14px;">${phase.description}</div>
    </div>`;

    html += '<div class="section-header">Tasks & Skills</div>';
    html += '<div class="card" style="background: transparent;">';
    
    phase.tasks.forEach((task, idx) => {
        html += `
            <div class="list-item" style="background: var(--card-bg); margin-bottom: 1px; ${idx===0?'border-top-left-radius:12px;border-top-right-radius:12px;':''} ${idx===phase.tasks.length-1?'border-bottom-left-radius:12px;border-bottom-right-radius:12px;':''}" onclick='openTask(${JSON.stringify(task)})'>
                <div class="list-item-content">
                    <div class="item-primary">${task.name} <span class="tag">${task.type}</span></div>
                    <div class="item-secondary">Click for full details</div>
                </div>
                <div class="chevron">›</div>
            </div>
        `;
    });
    html += '</div>';
    openModal(`Phase ${phase.id}`, html);
}

function openTask(task) {
    let html = '<div class="card" style="padding: 20px;">';
    
    // Details (using pre-wrap in CSS to handle newlines)
    if (task.details) {
         html += `
            <div class="detail-group">
                <div class="detail-label">Details & How To</div>
                <div class="detail-value">${task.details}</div>
            </div>
        `;
    }

    if (task.deliverable) {
        html += `
            <div class="detail-group">
                <div class="detail-label">Deliverable</div>
                <div class="detail-value">${task.deliverable}</div>
            </div>
        `;
    }

    if (task.done) {
        html += `
            <div class="detail-group">
                <div class="detail-label" style="color: var(--accent);">Definition of Done</div>
                <div class="detail-value" style="font-weight: 500;">${task.done}</div>
            </div>
        `;
    }

    html += '</div>';
    openModal("Task Details", html);
}

// --- Initialization ---
window.addEventListener('load', () => {
    renderDayNav();
    renderMainContent();
    const activeDay = document.querySelector('.day-pill.active');
    if (activeDay) {
        activeDay.scrollIntoView({ behavior: 'smooth', block: 'nearest', inline: 'center' });
    }
});

</script>
</body>
</html>